package com.myapp.project; import android.app.ProgressDialog; import android.content.Intent; import android.os.Bundle; import android.text.TextUtils; import android.view.animation.Animation; import android.view.animation.AnimationUtils; import android.widget.Toast; import android.content.SharedPreferences; import java.util.HashSet; import java.util.Set; import androidx.annotation.NonNull; import androidx.appcompat.app.AppCompatActivity; import com.google.android.material.button.MaterialButton; import com.google.android.material.textfield.TextInputEditText; import com.google.firebase.auth.FirebaseAuth; import com.google.firebase.auth.FirebaseUser; public class LoginActivity extends AppCompatActivity { private TextInputEditText etEmail, etPassword; private MaterialButton btnLogin, btnRegister; private FirebaseAuth mAuth; private ProgressDialog progressDialog; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_login); etEmail = findViewById(R.id.etEmail); etPassword = findViewById(R.id.etPassword); btnLogin = findViewById(R.id.btnLogin); btnRegister = findViewById(R.id.btnRegister); mAuth = FirebaseAuth.getInstance(); progressDialog = new ProgressDialog(this); progressDialog.setMessage("Vui lòng đợi..."); progressDialog.setCancelable(false); btnLogin.setOnClickListener(v -> loginUser()); btnRegister.setOnClickListener(v -> { Intent intent = new Intent(LoginActivity.this, RegisterActivity.class); startActivity(intent); overridePendingTransition(android.R.anim.slide_in_left, android.R.anim.slide_out_right); }); String savedEmail = getIntent().getStringExtra("email"); if (savedEmail != null) { etEmail.setText(savedEmail); etEmail.setEnabled(false); etPassword.requestFocus(); } animateViews(); } private void animateViews() { Animation fadeIn = AnimationUtils.loadAnimation(this, android.R.anim.fade_in); etEmail.startAnimation(fadeIn); etPassword.startAnimation(fadeIn); btnLogin.startAnimation(fadeIn); btnRegister.startAnimation(fadeIn); } @Override protected void onStart() { super.onStart(); FirebaseUser user = mAuth.getCurrentUser(); if (user != null) { startActivity(new Intent(this, MainActivity.class)); finish(); } } private void loginUser() { String email = etEmail.getText().toString().trim(); String password = etPassword.getText().toString().trim(); if (TextUtils.isEmpty(email)) { etEmail.setError("Nhập email"); return; } if (TextUtils.isEmpty(password)) { etPassword.setError("Nhập password"); return; } progressDialog.show(); mAuth.signInWithEmailAndPassword(email, password) .addOnCompleteListener(task -> { progressDialog.dismiss(); if (task.isSuccessful()) { FirebaseUser user = mAuth.getCurrentUser(); if (user != null) { saveAccount(email, user.getUid()); } Toast.makeText(LoginActivity.this, "Đăng nhập thành công!", Toast.LENGTH_SHORT).show(); startActivity(new Intent(LoginActivity.this, MainActivity.class)); finish(); } else { Toast.makeText(LoginActivity.this, "Lỗi: " + task.getException().getMessage(), Toast.LENGTH_LONG).show(); } }); } private void saveAccount(String email, String uid) { SharedPreferences prefs = getSharedPreferences("accounts", MODE_PRIVATE); Set<String> accounts = prefs.getStringSet("list", new HashSet<>()); accounts.add(email + "|" + uid); prefs.edit().putStringSet("list", accounts).apply(); } }